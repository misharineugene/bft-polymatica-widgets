tinymce.PluginManager.add('tpls', function (editor, url) {
  var openDialog = function () {
    return editor.windowManager.open({
      title: 'String templates',
      body: {
        type: 'panel',
        items: [
          {
            type: 'checkbox',
            label: 'Series name',
            name: 'series',
          },
          {
            type: 'checkbox',
            label: 'The name of a data item',
            name: 'name',
          },
          {
            type: 'checkbox',
            label: 'The value of a data item',
            name: 'value',
          },
          {
            type: 'checkbox',
            label: 'The percent',
            name: 'percent',
          },
          {
            type: 'checkbox',
            label: 'The loop',
            name: 'loop',
          },
        ],
      },
      buttons: [
        {
          type: 'cancel',
          text: 'Close',
        },
        {
          type: 'submit',
          text: 'Paste',
          primary: true,
        },
      ],
      onSubmit: function (api) {
        var data = api.getData();
        var content = Object.keys(data)
          .filter((key) => data[key])
          .map((key) => {
            if (key === 'loop') {
              return `{${key}}<strong>{name}</strong>: {value}{/${key}}`;
            }

            return `{${key}}`;
          });
        editor.insertContent(content.join(''));
        api.close();
      },
    });
  };

  editor.ui.registry.addIcon(
    'tplsIcon',
    '<svg height="16" width="16" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M16 4C14 4 11 5 11 9C11 13 11 15 11 18C11 21 6 23 6 23C6 23 11 25 11 28C11 31 11 35 11 39C11 43 14 44 16 44" stroke="#222F3E" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M32 4C34 4 37 5 37 9C37 13 37 15 37 18C37 21 42 23 42 23C42 23 37 25 37 28C37 31 37 35 37 39C37 43 34 44 32 44" stroke="#222F3E" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>',
  );

  editor.ui.registry.addButton('tpls', {
    icon: 'tplsIcon',
    tooltip: 'Templates',
    onAction: function () {
      openDialog();
    },
  });

  tinymce.addI18n('ru', {
    'String templates': 'Шаблоны строк',
    'Series name': 'Название серии',
    'The name of a data item': 'Название показателя',
    'The value of a data item': 'Значение показателя',
    'The percent': 'Процент показателя',
    'The loop': 'Цикл из показателей',
  });

  // return {
  //   getMetadata: function () {
  //     return {
  //       name: 'Example plugin',
  //       url: 'http://exampleplugindocsurl.com',
  //     };
  //   },
  // };
});
